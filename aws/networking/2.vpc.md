### **VPC (Virtual Private Cloud) - Fundamentals**  

Amazon Virtual Private Cloud (VPC) is a logically isolated network environment within AWS that enables users to provision and manage cloud resources with granular control over IP addressing, subnetting, routing, and security.  

VPC provides **highly available, scalable, and secure** networking infrastructure within AWS, allowing organizations to build cloud-based architectures with **fine-grained control** over traffic flow, security, and connectivity.


---

## **1ï¸âƒ£ Subnets (Public & Private)**  
A **VPC subnet** is a range of IP addresses in your VPC. It can be **public** or **private**, depending on whether it has internet access.

### **ğŸ”¹ Public Subnet**  
âœ… **Has a route to the Internet Gateway (IGW)** â†’ Used for EC2 instances that need to communicate with the internet.  

ğŸ”¹ Example:  
- **Web servers**  
- **Bastion hosts**  

### **ğŸ”¹ Private Subnet**  
âœ… **No direct internet access** â†’ Used for resources that should remain private.  

ğŸ”¹ Example:  
- **Databases (RDS, DynamoDB)**  
- **Application servers**  
- **Internal microservices**  

---

## **2ï¸âƒ£ Route Table & Subnet Route Table Association**  
A **Route Table** defines **how traffic is routed** within a VPC. Each subnet must be **associated** with a route table.

### **ğŸ”¹ Default Route Table (Local Routing)**  
By default, all subnets in a VPC can **communicate with each other** through local routing.

### **ğŸ”¹ Custom Route Table Example**  
- Public Subnet â†’ **Has a route to IGW**  
- Private Subnet â†’ **Has a route to NAT Gateway (for outbound traffic)**  

ğŸ”¹ Example Route Table:  

| Destination   | Target       | Purpose |
|--------------|-------------|---------|
| 10.0.0.0/16 | local       | Internal VPC traffic |
| 0.0.0.0/0   | igw-xxxxxx  | Public internet access |
| 0.0.0.0/0   | nat-xxxxxx  | Private subnet access via NAT |

---

## **3ï¸âƒ£ Internet Gateway (IGW)**  
âœ… **IGW allows internet access** for resources in the VPC.  

ğŸ”¹ **How it works:**  
- IGW is attached to the VPC.  
- A public subnet must have a **route to IGW** in its route table.  
- EC2 instances in a public subnet need an **Elastic IP** or **public IP**.  

ğŸ”¹ **Command to attach IGW (AWS CLI):**  
```sh
aws ec2 attach-internet-gateway --internet-gateway-id igw-xxxx --vpc-id vpc-xxxx
```

---

## **4ï¸âƒ£ NAT Gateway & Elastic IP (EIP)**  
âœ… **NAT Gateway (NATGW) allows private instances to access the internet** without exposing them publicly.

ğŸ”¹ **Use Case:**  
- Private EC2 instances need to download software updates.  
- A private backend server needs to call an external API.  

ğŸ”¹ **How it works:**  
- NATGW is placed in a **public subnet**.  
- It has an **Elastic IP (EIP)** for outbound traffic.  
- Private subnets route internet traffic via NATGW.

---

## **5ï¸âƒ£ Security Groups (SG) - Instance-Level Firewall**  
âœ… **SGs control inbound & outbound traffic for instances.**  

ğŸ”¹ **Rules are STATEFUL** â†’ If inbound traffic is allowed, the response is automatically allowed.  

ğŸ”¹ **Example SG Rules:**  
| Type  | Protocol | Port  | Source      | Purpose        |
|-------|---------|------|------------|--------------|
| SSH   | TCP     | 22   | My IP only | Admin Access  |
| HTTP  | TCP     | 80   | 0.0.0.0/0  | Public Web App |

---

## **6ï¸âƒ£ NACLs (Network ACLs) - Subnet-Level Firewall**  
âœ… **NACLs control traffic at the subnet level.**  

ğŸ”¹ **Rules are STATELESS** â†’ Both inbound and outbound rules must be explicitly defined.  

ğŸ”¹ **Example NACL Rules:**  
| Rule # | Type  | Protocol | Port  | Source     | Action |
|--------|------|---------|------|-----------|--------|
| 100    | HTTP  | TCP     | 80   | 0.0.0.0/0 | ALLOW  |
| 200    | SSH   | TCP     | 22   | 0.0.0.0/0 | DENY   |

âœ… **Use Case:**  
- Extra layer of security beyond Security Groups.  
- Block malicious IPs at the subnet level.  

---

## **7ï¸âƒ£ VPC Peering**  
âœ… **Allows communication between two VPCs** over AWS internal network.  

ğŸ”¹ **Use Case:**  
- Connecting different AWS accounts.  
- Connecting microservices in separate VPCs.  

ğŸ”¹ **Key Points:**  
- Peering is **one-to-one** (not transitive).  
- No overlapping CIDR blocks.  
- Route tables must be updated for traffic flow.  

ğŸ”¹ **AWS CLI Command:**  
```sh
aws ec2 create-vpc-peering-connection --vpc-id vpc-1 --peer-vpc-id vpc-2
```

---

## **8ï¸âƒ£ VPC Flow Logs**  
âœ… **Monitors network traffic** going in and out of your VPC.

ğŸ”¹ **Use Case:**  
- Debugging connectivity issues.  
- Security monitoring (detecting unauthorized access).  

ğŸ”¹ **Log Destination:**  
- CloudWatch  
- S3  

ğŸ”¹ **AWS CLI Command to Enable Flow Logs:**  
```sh
aws ec2 create-flow-logs --resource-type VPC --resource-ids vpc-xxxx --traffic-type ALL --log-destination arn:aws:logs:us-east-1:xxxx:log-group/vpc-logs
```

---

## **9ï¸âƒ£ VPC Endpoints (Gateway & Interface)**  
âœ… **Allows AWS services (like S3, DynamoDB) to be accessed privately from a VPC** without using IGW or NATGW.  

ğŸ”¹ **Types:**  
- **Gateway Endpoint** â†’ Used for S3, DynamoDB (routes added in route table).  
- **Interface Endpoint** â†’ Used for services like SNS, SQS, Secrets Manager (Elastic Network Interface created).  

ğŸ”¹ **AWS CLI Example:**  
```sh
aws ec2 create-vpc-endpoint --vpc-id vpc-xxxx --service-name com.amazonaws.us-east-1.s3 --vpc-endpoint-type Gateway
```

---

## **ğŸ”Ÿ Transit Gateway (TGW)**  
âœ… **Connects multiple VPCs and on-premises networks** in a hub-and-spoke model.  

ğŸ”¹ **Key Benefits:**  
- More **scalable than VPC Peering** (supports multiple VPCs).  
- Simplifies **network architecture**.  
- Reduces the number of route table updates.  

ğŸ”¹ **Example Use Case:**  
- Connecting multiple VPCs to a **centralized firewall** or **VPN**.  

---

## **1ï¸âƒ£1ï¸âƒ£ Traffic Mirroring (Phase-2 Learning)**  
âœ… **Captures and inspects traffic** in a VPC by mirroring network packets.  

ğŸ”¹ **Use Cases:**  
- **Security analysis** (detect intrusions).  
- **Network monitoring** (detect performance issues).  
---